[{"content":"步骤很简单 同步 Notion 到 GitHub 使用 GitHub Actions：\n修改 GitHub Action 配置，以适配 Hugo 主题，借助 GPT 进行修改非常容易。 对同步过来的 Markdown 文件进行定制修改，主要根据所使用的 Hugo 主题来进行操作。\n注意：自定义的 GitHub Action 已经完成了这部分工作，不需要额外操作。 完成修改后，拉取 Hugo 博客源文件，并将 Markdown 文件复制并替换到相应位置。\n进行编译和部署操作。\n完成以上步骤后，可以访问已同步的博客内容。\n项目作用 为了创建一个定制的 GitHub Action 以适应 Hugo 博客系统，我们可以遵循以下步骤来修改现有的 Notion 转 Markdown 的代码。这个过程涉及到对元数据、图片路径和中文字符的处理，以确保兼容性和渲染效果。\n修改封面图的处理：\n当前的 Action 将 Notion 的封面图作为 cover 字段处理。在 Hugo 中，我们需要将此字段修改为 image。\n此外，需要去除封面图的路径信息，因为 Hugo 在某些配置下可能无法正确渲染带路径的图片。\n修改 Markdown 文件中的图片路径：\n对于 Markdown 文件中的图片，也需要移除路径信息。这是为了确保 Hugo 能正确找到并渲染这些图片。 处理路径中的中文字符：\n如果路径信息中包含中文字符，可能会导致乱码问题。因此，需要将这些路径信息转换为英文，并使用下划线连接。 AST（抽象语法树）解析：\n由于 Notion 文件包含 YAML（用于元数据）和 Markdown（用于正文）两部分，需要使用不同的 AST 解析器来处理这两种格式。 最终的 GitHub Action 功能：\n能够抓取 Notion 文件并将其转换为适配 Hugo Stack 主题的 Markdown 文件。\n同时抓取 Notion 中的图片，并在本地保存。这些图片由 GitHub 进行渲染，大大节省了处理时间和资源。\n潜在的改进：\n目前，这个 Action 不支持处理嵌入的第三方内容（如 YouTube 视频）。今后有可能进行改进以增加此功能。 通过这些修改，该 GitHub Action 能够有效地将 Notion 内容转换为 Hugo 可用的格式，同时优化图片处理和路径问题，以适应 Hugo 的渲染机制。这不仅提高了博客的管理效率，而且保证了内容的兼容性和可视化效果。\n仓库对应的每个步骤 main 同步notion脚本\nibm hugo源码文件 + md文件\nnotion 最终生成发布的静态网页\n步骤描述图 noiton需要提供的有两个值：\n访问地址 访问这个地址的key 关键词：\nNotion API integrations – Notion Help Center\nWith Notion\u0026rsquo;s API, you\u0026rsquo;ll be able to create custom internal integrations. Some of our partners may also require an internal integration token in order to link their platform to your Notion workspace - below, we\u0026rsquo;ll walk you through how to set this up 🏗️\nhttps://www.notion.so/help/create-integrations-with-the-notion-api\n中间用到了2个流水线。 mian.yml 和 deploy.yml\n分别做详细介绍：\nmain.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 # This is a basic workflow to help you get started with Actions name: NotionJAM # Controls when the workflow will run on: schedule: - cron: \u0026#34;0 21 * * *\u0026#34; # daily push: branches: [master, main] # Allows you to run this workflow manually from the Actions tab workflow_dispatch: # A workflow run is made up of one or more jobs that can run sequentially or in parallel jobs: # This workflow contains a single job called \u0026#34;build\u0026#34; build: # The type of runner that the job will run on runs-on: ubuntu-latest permissions: # Give the default GITHUB_TOKEN write permission to commit and push the # added or changed files to the repository. contents: write # Steps represent a sequence of tasks that will be executed as part of the job steps: # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it - uses: actions/checkout@v3 - name: notion-jam uses: victornpb/notion-jam@v0.0.10 with: NOTION_SECRET: ${{ secrets.NOTION_SECRET }} NOTION_DATABASE: https://www.notion.so/a2a70d82655a42b382921fb3d644acb0 FILTER_PROP: Status FILTER_VALUES: Published CONVERT_PROP_CASE: snake ARTICLE_PATH: content/posts/{title}/README.md ASSETS_PATH: ./ PARALLEL_PAGES: 25 PARALLEL_DOWNLOADS_PER_PAGE: 3 DOWNLOAD_IMAGE_TIMEOUT: 30 SKIP_DOWNLOADED_IMAGES: true DOWNLOAD_FRONTMATTER_IMAGES: true - name: List files in the repository run: | echo \u0026#34;Listing all files and directories:\u0026#34; ls -R - name: Update Markdown files run: | # Find all markdown files and process them for file in $(find . -name \u0026#39;*.md\u0026#39;); do # Check if the file is README.md if [ \u0026#34;$(basename \u0026#34;$file\u0026#34;)\u0026#34; = \u0026#34;README.md\u0026#34; ]; then # Rename README.md to index.md mv \u0026#34;$file\u0026#34; \u0026#34;$(dirname \u0026#34;$file\u0026#34;)/index.md\u0026#34; # Update file variable to new path file=\u0026#34;$(dirname \u0026#34;$file\u0026#34;)/index.md\u0026#34; fi # Check if file exists before proceeding if [ -f \u0026#34;$file\u0026#34; ]; then # Extract the thumbnail filename thumbnail=$(grep \u0026#39;_thumbnail:\u0026#39; \u0026#34;$file\u0026#34; | sed \u0026#39;s/_thumbnail: .\\///\u0026#39;) # Add the image field with the extracted thumbnail filename sed -i \u0026#34;/_thumbnail: .*/a image: ${thumbnail}\u0026#34; \u0026#34;$file\u0026#34; sed -i \u0026#39;/slug: saul/d\u0026#39; \u0026#34;$file\u0026#34; # Remove the dot and backslash before the image path in markdown files sed -i \u0026#39;s/!\\[\\](\\.\\//!\\[\\](/g\u0026#39; \u0026#34;$file\u0026#34; sed -i \u0026#39;/type: gallery/d\u0026#39; \u0026#34;$file\u0026#34; if [ -f \u0026#34;./README.md\u0026#34; ]; then rm \u0026#34;./README.md\u0026#34; fi else echo \u0026#34;File not found: $file\u0026#34; fi done - name: Save changes uses: stefanzweifel/git-auto-commit-action@v4 with: commit_message: Commit changes branch: feature-test push_options: \u0026#39;--force\u0026#39; create_branch: true - name: Checkout vip repository uses: actions/checkout@v2 with: repository: s110b/vip ref: master path: app ssh-key: ${{ secrets.MY_SSH_PRIVATE_KEY }} - name: Checkout current repository (feature-test) uses: actions/checkout@v2 with: ref: feature-test path: content - name: Copy content to app/content/post/notion and show directory structure before run: | echo \u0026#34;Directory structure before changes:\u0026#34; tree app/ || sudo apt-get install tree \u0026amp;\u0026amp; tree app/ rm -rf app/content/post/* mkdir -p app/content/post/notion cp -r content/content/posts/* app/content/post/notion/ echo \u0026#34;Directory structure after changes:\u0026#34; tree app/ - name: Deploy 🚀 uses: JamesIves/github-pages-deploy-action@v4 with: repository-name: \u0026#34;s110b/notion\u0026#34; branch: ibm folder: app clean: true single-commit: true force: true ssh-key: ${{ secrets.MY_SSH_PRIVATE_KEY }} 上面流水线完成任务如下 转换notion为md文件\nshell修改md格式，去掉无用列，增加主页图片\n下载hugo网站源文件，合并md文件到源文件\n提交到ibm分支。\ndeploy.yml文件内容\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 name: deploy on: schedule: - cron: \u0026#34;0 21 * * *\u0026#34; # daily push: branches: [master, main] jobs: build: runs-on: ubuntu-latest permissions: # Give the default GITHUB_TOKEN write permission to commit and push the # added or changed files to the repository. contents: write steps: - uses: actions/checkout@v3 with: ref: ibm - name: Cache Hugo resources uses: actions/cache@v3 env: cache-name: cache-hugo-resources with: path: resources key: ${{ env.cache-name }} - uses: actions/setup-go@v4 with: go-version: \u0026#34;^1.17.0\u0026#34; - run: go version - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#34;latest\u0026#34; extended: true - name: Build run: hugo --minify --gc --baseURL \u0026#34;/notion/\u0026#34; - name: Deploy 🚀 uses: JamesIves/github-pages-deploy-action@v4 with: repository-name: \u0026#34;s110b/notion\u0026#34; branch: notion folder: public clean: true single-commit: true force: true ssh-key: ${{ secrets.MY_SSH_PRIVATE_KEY }} # Use the new token 编译源文件为静态网页 默认的github deploy到pages的不多做介绍。\n","date":"2024-09-27T07:17:00Z","image":"/notion1/p/%E7%94%A8notion%E5%88%9B%E5%BB%BA%E5%90%8C%E6%AD%A5blog/nasa_space_shuttle_challenger_wQfpyT9P_hubd06f5f73ec40802f2705ea8653c83b7_134650_120x120_fill_q75_box_smart1.jpg","permalink":"/notion1/p/%E7%94%A8notion%E5%88%9B%E5%BB%BA%E5%90%8C%E6%AD%A5blog/","title":"用notion创建同步blog"}]